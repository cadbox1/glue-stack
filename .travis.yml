jobs:
  include:
  - stage: test
    name: api test
    language: java
    jdk: oraclejdk8
    services:
    - docker
    before_install:
    - cd api
    install: true
    script: mvn clean install
  - stage: test
    name: ui test
    language: node_js
    node_js: '8'
    before_install:
    - cd ui
    install: yarn
    script: yarn test
  - stage: deploy api
    language: java
    jdk: oraclejdk8
    services:
    - docker
    before_install:
    - cd api
    install: true
    script: mvn package -DskipTests=true -Dmaven.javadoc.skip=true -B -V
    deploy:
      provider: elasticbeanstalk
      skip_cleanup: true
      on:
        all_branches: true
      access_key_id: access_key_id
      secret_access_key:
        secure: secret_access_key
      region: ap-southeast-2
      app: Glue Stack
      env: GlueStack-env
      bucket_name: elasticbeanstalk-ap-southeast-2-019794990741
      zip_file: target/api-0.0.1-SNAPSHOT.jar
  - stage: deploy ui
    language: node_js
    node_js: '8'
    before_install:
    - cd ui
    install: yarn
    script: yarn build
    deploy:
      provider: s3
      skip_cleanup: true
      on:
        all_branches: true
      access_key_id: access_key_id
      secret_access_key: secret_access_key
      bucket: gluestack
      region: ap-southeast-2
      local_dir: build
notifications:
  email: false
env:
  secure: uAisol22LY6qIaxZGw5R4oe4baok5CRtuK1yOQSAGXVHVuR1S03VyfVSNyk5BvBX98skmvRiq9EQMF6d/pkDXK2VuZcDrDt5lMqtKB3CL6xQu6Zk/+1ENk5isbrRZG3xXmCu4VKpapojzlkvCwareQUeiGkFH5Qb2Lj3kuEHJrUc2rVfizhtHBsGXOc0qXf+TSTRwR24hUDXN3+4IYM60Qb62j0I2r3m9B92xsQZX8sNssqCLwZsSap1TMfHjlDzeqUssHZIt02+qk+WzuAfZqo8Wco3hTBSJ1QqPaeqHLP8S9p41V6CE6aqun3K5nzST0TkTFcWBPQld2V1q+eLquxI2s271Q7YREm6yr9XNOKhemHAS4YMAFbxeJoj6CvQvix4qYq3ncCRHEcXWVfCkm4OnHUAaFCM2bt4Z/eAxZm9kbIoWkHCAtQYJFC/Vkgya+s7x3oV07PyF1LTMDhXASUj+qgqrKySiapAnjaxtJpbzrxa8/0dCDrHljhcDMt9tNq7Ilkr8UYf8czFz0EszzYeQZl3MRk85lPHZoxnod2Kpiv5O8u+NU8y2usO/iLkPPpjUfRhIkk5bJDC9Cfm4+nUDjtlaXSp43Z2oeMg9fkoibYixEMrvcEkj4t+7Rgu2v8gWUiy5T0U6jrLeKGXcvRaeOsU10DjqvCRG+uTV20=
